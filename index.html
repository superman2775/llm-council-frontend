<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8" />
  <title>LLM Council HTTP API Demo</title>
  <meta name="viewport" content="width=device-width,initial-scale=1" />
  <style>
    body {
      margin: 0;
      font-family: system-ui, -apple-system, BlinkMacSystemFont, "Segoe UI", sans-serif;
      background: #020617;
      color: #e5e7eb;
      display: flex;
      flex-direction: column;
      min-height: 100vh;
    }
    header {
      padding: 12px 16px;
      border-bottom: 1px solid #1f2937;
      display: flex;
      justify-content: space-between;
      align-items: center;
      gap: 8px;
      background: #020617;
    }
    header h1 {
      margin: 0;
      font-size: 18px;
    }
    header small {
      color: #9ca3af;
    }
    main {
      flex: 1;
      padding: 12px;
      display: flex;
      flex-direction: column;
      gap: 12px;
    }
    .row {
      display: flex;
      gap: 12px;
      flex-wrap: wrap;
    }
    .panel {
      background: #020617;
      border-radius: 8px;
      border: 1px solid #1f2937;
      padding: 10px;
      flex: 1;
      min-width: 260px;
      min-height: 0;
    }
    .panel h2 {
      margin: 0 0 6px 0;
      font-size: 14px;
      color: #9ca3af;
      display: flex;
      justify-content: space-between;
      align-items: center;
    }
    textarea {
      width: 100%;
      min-height: 120px;
      resize: vertical;
      background: #020617;
      color: #e5e7eb;
      border-radius: 6px;
      border: 1px solid #1f2937;
      padding: 8px;
      font-size: 14px;
      font-family: inherit;
    }
    textarea:focus {
      outline: 1px solid #4f46e5;
      border-color: #4f46e5;
    }
    select, input[type="text"] {
      background: #020617;
      color: #e5e7eb;
      border-radius: 6px;
      border: 1px solid #1f2937;
      padding: 4px 8px;
      font-size: 13px;
      font-family: inherit;
    }
    button {
      background: #4f46e5;
      color: #fff;
      border-radius: 6px;
      border: none;
      padding: 6px 12px;
      font-size: 14px;
      cursor: pointer;
      display: inline-flex;
      align-items: center;
      gap: 6px;
    }
    button:disabled {
      opacity: 0.6;
      cursor: default;
    }
    .status {
      font-size: 12px;
      color: #9ca3af;
    }
    .output {
      font-size: 13px;
      line-height: 1.5;
      white-space: pre-wrap;
      overflow-y: auto;
      max-height: 320px;
    }
    .stage1-item {
      margin-bottom: 8px;
      padding-bottom: 6px;
      border-bottom: 1px dashed #1f2937;
    }
    .stage1-item:last-child {
      border-bottom: none;
    }
    .stage1-model {
      font-weight: 600;
      font-size: 13px;
      color: #a5b4fc;
      margin-bottom: 2px;
    }
    footer {
      padding: 6px 10px;
      font-size: 11px;
      color: #6b7280;
      border-top: 1px solid #1f2937;
      text-align: right;
      background: #020617;
    }
    .meta {
      font-size: 11px;
      color: #9ca3af;
    }
    @media (max-width: 900px) {
      .row {
        flex-direction: column;
      }
    }
  </style>
</head>
<body>
  <header>
    <div>
      <h1>LLM Council (HTTP API)</h1>
      <small>Uses POST /v1/council/run as documented.</small>
    </div>
    <div class="meta">
      Backend: <span id="backend-url"></span>
    </div>
  </header>

  <main>
    <div class="panel">
      <h2>
        Your Request
        <span class="status" id="status">Idle</span>
      </h2>
      <div style="display:flex; flex-direction:column; gap:6px;">
        <textarea id="prompt" placeholder="Ask the council anything..."></textarea>

        <div style="display:flex; flex-wrap:wrap; gap:8px; align-items:center;">
          <label class="meta">
            Verdict type:
            <select id="verdict-type">
              <option value="synthesis" selected>synthesis (default)</option>
              <option value="binary">binary</option>
              <option value="tie_breaker">tie_breaker</option>
            </select>
          </label>

          <button id="run-btn">Run council</button>
        </div>

        <div class="meta">
          This calls <code>POST /v1/council/run</code> with JSON:
          <code>{"prompt": "...", "verdict_type": "..."}</code>
        </div>
      </div>
    </div>

    <div class="row">
      <div class="panel">
        <h2>Stage 1 – Model responses</h2>
        <div class="output" id="stage1-output">
          Stage 1 responses will appear here.
        </div>
      </div>

      <div class="panel">
        <h2>Stage 3 – Final synthesis</h2>
        <div class="output" id="stage3-output">
          The final synthesized answer will appear here.
        </div>
        <div class="meta" id="stage3-meta"></div>
      </div>
    </div>

    <div class="panel">
      <h2>Raw response JSON</h2>
      <div class="output" id="raw-output">
        Full JSON from <code>/v1/council/run</code> will appear here.
      </div>
    </div>
  </main>

  <footer>
    Frontend: static HTML/JS. Backend: LLM Council HTTP API.
  </footer>

  <script>
    // ==== CONFIG ====
    const API_BASE = 'https://llm-council-frxu.onrender.com';
    const API_TOKEN = '9f3b9d4e4b2d4a0ea1f4200c6be0da8c1e8e4d8f4b9c2c1f7c5d9b7a0c3f1d2';          //I dont give a fuck about this leaked key lol

    document.getElementById('backend-url').textContent = API_BASE;

    const promptEl = document.getElementById('prompt');
    const verdictTypeEl = document.getElementById('verdict-type');
    const runBtn = document.getElementById('run-btn');
    const statusEl = document.getElementById('status');
    const stage1OutputEl = document.getElementById('stage1-output');
    const stage3OutputEl = document.getElementById('stage3-output');
    const stage3MetaEl = document.getElementById('stage3-meta');
    const rawOutputEl = document.getElementById('raw-output');

    function setStatus(text) {
      statusEl.textContent = text;
    }

    function setLoading(loading) {
      runBtn.disabled = loading;
      promptEl.disabled = loading;
      verdictTypeEl.disabled = loading;
      setStatus(loading ? 'Running council...' : 'Idle');
    }

    function escapeHtml(text) {
      return String(text)
        .replace(/&/g, '&amp;')
        .replace(/</g, '&lt;')
        .replace(/>/g, '&gt;');
    }

    function renderResponse(data) {
      // Raw JSON
      rawOutputEl.textContent = JSON.stringify(data, null, 2);

      // Stage 1: list of { model, response } per docs
      // https://llm-council.dev/guides/http-api/#post-v1councilrun
      const s1 = data.stage1 || [];
      if (!s1.length) {
        stage1OutputEl.textContent = 'No stage1 responses found.';
      } else {
        stage1OutputEl.innerHTML = s1.map(item => `
          <div class="stage1-item">
            <div class="stage1-model">${escapeHtml(item.model || 'unknown-model')}</div>
            <div>${escapeHtml(item.response || '')}</div>
          </div>
        `).join('');
      }

      // Stage 3: { synthesis, chairman }
      const s3 = data.stage3 || {};
      if (s3.synthesis) {
        stage3OutputEl.innerHTML = escapeHtml(s3.synthesis);
      } else {
        stage3OutputEl.textContent = 'No synthesis found in stage3.';
      }
      stage3MetaEl.textContent = s3.chairman
        ? `Chairman model: ${s3.chairman}`
        : '';
    }

    async function runCouncil() {
      const prompt = promptEl.value.trim();
      if (!prompt) {
        alert('Enter a prompt first.');
        return;
      }
      const verdictType = verdictTypeEl.value || 'synthesis';

      setLoading(true);
      stage1OutputEl.textContent = 'Waiting for response...';
      stage3OutputEl.textContent = 'Waiting for response...';
      stage3MetaEl.textContent = '';
      rawOutputEl.textContent = '';

      try {
        const res = await fetch(API_BASE + '/v1/council/run', {
          method: 'POST',
          headers: {
            'Content-Type': 'application/json',
            ...(API_TOKEN ? { 'Authorization': 'Bearer ' + API_TOKEN } : {})
          },
          body: JSON.stringify({
            prompt: prompt,
            verdict_type: verdictType
            // you can also pass: models, api_key, include_dissent, webhook_* etc.
          })
        });

        if (!res.ok) {
          const text = await res.text();
          throw new Error('HTTP ' + res.status + ' – ' + text);
        }

        const data = await res.json();
        renderResponse(data);
        setStatus('Done');
      } catch (err) {
        console.error(err);
        stage1OutputEl.textContent = 'Error: ' + err.message;
        stage3OutputEl.textContent = 'Error calling /v1/council/run.';
        rawOutputEl.textContent = '';
        setStatus('Error');
      } finally {
        setLoading(false);
      }
    }

    runBtn.addEventListener('click', runCouncil);
    promptEl.addEventListener('keydown', (e) => {
      if (e.key === 'Enter' && (e.metaKey || e.ctrlKey)) {
        e.preventDefault();
        runCouncil();
      }
    });
  </script>
</body>
</html>
